<!--
  This script runs before any CSS or content loads.
  It checks if the user previously chose dark mode (saved in localStorage).
  If so, it adds the 'dark-mode' class to <html> and <body> immediately,
  so the page loads in dark mode with no flash of light mode.
-->
<script>
  if (localStorage.getItem('padDarkMode') === 'true') {
    document.documentElement.classList.add('dark-mode'); // <html> tag
    document.body.classList.add('dark-mode');           // <body> tag
  }
</script>
<%- include('../layout') %>

<!--
  === PAD UI STRUCTURE ===
  This file builds the main notes interface (the "pad").
  - The header contains the logo, dark mode toggle, and logout link.
  - The dropdown lets you pick a tag/category and then a note title.
  - The form below is for creating or editing a note.
  - The delete form lets you delete the currently loaded note.
-->
<link rel="stylesheet" href="/stylesheets/pad.css">
<script src="/javascripts/pad.js" defer></script>
<!-- Header: logo, dark mode toggle, logout -->
<div class="pad-header">
  <!-- App logo -->
  <div class="pad-logo">
    <span class="angle">&lt;</span><span class="logo-c">c</span><span class="logo-slash">/</span><span class="logo-note">note</span><span class="angle">&gt;</span>
  </div>
  <!-- Dark mode toggle button (moon/sun icon) -->
  <div class="pad-mode-toggle" id="mode-toggle" tabindex="0" title="Toggle dark/light mode">
    <img src="/moon.svg" alt="Toggle dark/light mode" class="pad-moon-icon">
  </div>
  <!-- Logout link -->
  <a href="/logout" class="pad-logout-link">
    <span class="angle">&lt;</span>log/<span class="logout-out">out</span><span class="angle">&gt;</span>
  </a>
</div>

<!-- Main pad area: dropdown and forms -->
<div class="pad-main">
  <!-- Dropdown for tags and note titles -->
  <div class="pad-dropdown-container">
  <!-- Dropdown label (click to open/close) -->
  <label class="pad-dropdown-label" for="pad-dropdown" tabindex="0" id="padDropdownLabel">[pad]</label>
    <div class="pad-dropdown-list" id="padDropdownList" hidden>
      <!--
        Dropdown content:
        - For each tag/category, show a clickable label.
        - When a tag is clicked, show its notes (titles) as a sub-list.
        - When a note title is clicked, it loads that note into the form below.
      -->
      <% if (tags && tags.length) { %>
        <% tags.forEach(function(tag) { %>
          <div class="pad-tag-item" data-tag="<%= tag.name %>">
            <div class="pad-tag-label" tabindex="0"><%= tag.name %></div>
            <% if (tag.notes && tag.notes.length) { %>
              <div class="pad-titles-list" hidden>
                <% tag.notes.forEach(function(note) { %>
                  <div class="pad-title-item" data-id="<%= note._id %>" data-title="<%= note.title %>"><%= note.title %></div>
                <% }) %>
              </div>
            <% } %>
          </div>
        <% }) %>
      <% } else { %>
        <div class="pad-no-tags">No saved tags</div>
      <% } %>
    </div>
  </div>

  <!-- Main note form: create or edit a note -->
  <form id="pad-form" class="pad-form" method="POST" action="/notes" autocomplete="off">
    <!-- Tag/category input -->
    <input
      id="note-category"
      name="category"
      class="pad-input"
      type="text"
      placeholder="[tag]"
      value="<%= note ? note.category : '' %>"
      autocomplete="off"
      required
    />
    <!-- Note title input -->
    <input
      id="note-title"
      name="title"
      class="pad-input"
      type="text"
      placeholder="[title]"
      value="<%= note ? note.title : '' %>"
      autocomplete="off"
      required
    />
    <!-- Note body input -->
    <textarea
      id="note-body"
      name="body"
      class="pad-textarea"
      placeholder="..."
      required
    ><%= note ? note.body : '' %></textarea>
    <div style="display: flex; gap: 1rem; justify-content: flex-end; align-items: center; margin-top: 10px;">
      <button type="submit" class="pad-save-btn">Save</button>
    </div>
  </form>
  <!-- Delete form: deletes the currently loaded note (if any) -->
  <form id="pad-delete-form" action="" method="POST" style="display:inline; float:right; margin-top:-56px; margin-right:10px;">
    <input type="hidden" name="_method" value="DELETE">
    <button type="submit" class="pad-delete-btn" style="background:#d32f2f;color:#fff;font-weight:bold;border:none;border-radius:6px;padding:10px 22px;font-size:1.1rem;cursor:pointer;">Delete</button>
<!-- End of pad UI -->
  </form>
  </form>
</div>